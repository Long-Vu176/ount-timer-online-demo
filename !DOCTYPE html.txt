<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒê·∫øm Gi·ªù T√≠nh Ti·ªÅn Online</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    #time { font-size: 36px; margin: 10px; }
    #money { font-size: 24px; color: green; }
    input, button { font-size: 18px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border: 1px solid #ccc; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>
  <h1>üïí ƒê·∫øm Gi·ªù T√≠nh Ti·ªÅn Online</h1>

  <label>ƒê∆°n gi√° (ƒë/gi·ªù): <input id="rateInput" type="number" value="10000"></label><br>
  <div id="time">00:00:00</div>
  <div id="money">T·ªïng ti·ªÅn: 0 ƒë</div>

  <button onclick="startTimer()">‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu</button>
  <button onclick="stopTimer()">‚èπ D·ª´ng</button>
  <button onclick="resetTimer()">üîÑ Reset</button>
  <button onclick="saveTransaction()">üíæ L∆∞u h√≥a ƒë∆°n</button>
  <button onclick="printBill()">üñ® In h√≥a ƒë∆°n hi·ªán t·∫°i</button>
  <button onclick="clearHistory()">üóë X√≥a l·ªãch s·ª≠</button>

  <h2>L·ªãch s·ª≠ giao d·ªãch</h2>
  <table id="historyTable">
    <tr>
      <th>ID h√≥a ƒë∆°n</th>
      <th>Th·ªùi gian b·∫Øt ƒë·∫ßu</th>
      <th>Th·ªùi gian d√πng</th>
      <th>Ti·ªÅn</th>
      <th>In l·∫ßn cu·ªëi</th>
    </tr>
  </table>

  <script>
    let startTime, timerInterval, elapsed=0;

    function formatTime(ms) { /* ... nh∆∞ tr∆∞·ªõc ... */ }
    function calculateMoney(ms) {
      const rate = parseFloat(document.getElementById("rateInput").value)||0;
      return Math.round(ms/(1000*60*60)*rate);
    }
    function updateDisplay(ms){
      document.getElementById("time").textContent = formatTime(ms);
      document.getElementById("money").textContent = "T·ªïng ti·ªÅn: " + calculateMoney(ms).toLocaleString() + " ƒë";
    }
    function startTimer(){ /* ... nh∆∞ tr∆∞·ªõc ... */ }
    function stopTimer(){ /* ... */ }
    function resetTimer(){ /* ... */ }

    function saveTransaction(){
      if(!elapsed) return alert("Ch∆∞a c√≥ d·ªØ li·ªáu!");
      const now = new Date().toLocaleString();
      const duration = formatTime(elapsed);
      const money = calculateMoney(elapsed);
      const history = JSON.parse(localStorage.getItem("history")||"[]");
      const id = history.length+1;
      history.push({id, time: now, duration, money, lastPrinted: ""});
      localStorage.setItem("history", JSON.stringify(history));
      renderHistory();
    }

    function renderHistory(){
      const history = JSON.parse(localStorage.getItem("history")||"[]");
      const tbl = document.getElementById("historyTable");
      tbl.innerHTML = `<tr>
        <th>ID h√≥a ƒë∆°n</th><th>Th·ªùi gian b·∫Øt ƒë·∫ßu</th><th>Th·ªùi gian d√πng</th><th>Ti·ªÅn</th><th>In l·∫ßn cu·ªëi</th>
      </tr>`;
      history.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.id}</td><td>${row.time}</td><td>${row.duration}</td>
        <td>${row.money.toLocaleString()} ƒë</td><td>${row.lastPrinted||"-"}</td>`;
        tbl.appendChild(tr);
      });
    }

    function printBill(){
      if(!elapsed) return alert("Ch∆∞a c√≥ d·ª± li·ªáu!");
      const duration = formatTime(elapsed);
      const money = calculateMoney(elapsed).toLocaleString();
      const content = `H√ìA ƒê∆†N #${Date.now()}\nTh·ªùi gian: ${duration}\nTi·ªÅn: ${money} ƒë`;
      const w = window.open();
      w.document.write(`<pre style="font-size:18px;">${content}</pre>`);
      w.print(); w.close();

      // C·∫≠p nh·∫≠t l·∫°i th·ªùi gian in l·∫ßn cu·ªëi cho h√≥a ƒë∆°n v·ª´a in
      const history = JSON.parse(localStorage.getItem("history")||"[]");
      if(history.length){
        history[history.length-1].lastPrinted = new Date().toLocaleString();
        localStorage.setItem("history", JSON.stringify(history));
        renderHistory();
      }
    }

    function clearHistory(){
      if(confirm("X√≥a to√†n b·ªô l·ªãch s·ª≠?")){
        localStorage.removeItem("history");
        renderHistory();
      }
    }

    updateDisplay(0);
    renderHistory();
  </script>
</body>
</html>
